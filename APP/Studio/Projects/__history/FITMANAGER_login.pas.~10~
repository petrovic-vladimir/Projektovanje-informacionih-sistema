unit FITMANAGER_login;

interface

uses
  System.SysUtils, System.Types, System.UITypes, System.Classes, System.Variants,
  FMX.Types, FMX.Controls, FMX.Forms, FMX.Graphics, FMX.Dialogs, FMX.Layouts,
  FMX.ExtCtrls, FMX.Objects, FMX.Colors, FMX.Controls.Presentation, FMX.StdCtrls,
  FMX.Ani, FMX.Edit,
  FITMANAGER_register, FITMANAGER_dashboard, DB;

type
  TFrmLogin = class(TForm)
    LoginTemplate: TImage;
    loginBtn: TButton;
    FloatAnimation1: TFloatAnimation;
    Email_input: TEdit;
    Pass_input: TEdit;
    Create_account: TButton;
    procedure loginBtnClick(Sender: TObject);
    procedure Create_accountClick(Sender: TObject);
  private
    procedure OpenMemberDashboard;
  public
  end;

var
  FrmLogin: TFrmLogin;

implementation

{$R *.fmx}

procedure TFrmLogin.OpenMemberDashboard;
begin
  if FrmDashboard = nil then
    FrmDashboard := TFrmDashboard.Create(Application);

  FrmDashboard.Show;
  Self.Hide;
end;

procedure TFrmLogin.loginBtnClick(Sender: TObject);
var
  Login, Pass: string;
begin
  Login := Trim(Email_input.Text);
  Pass := Pass_input.Text;

  if (Login = '') or (Pass = '') then
  begin
    ShowMessage('Unesi email/username i lozinku.');
    Exit;
  end;

  if (dmDB <> nil) and dmDB.AuthenticateUser(Login, Pass) then
  begin
    case dmDB.CurrentRole of
      urMember:
        OpenMemberDashboard;

      urAdmin:
        ShowMessage('Ulogovan kao ADMIN. Admin dashboard jos nije povezan.');

      urInstructor:
        ShowMessage('Ulogovan kao INSTRUCTOR. Trainer dashboard jos nije povezan.');
    else
      ShowMessage('Korisnik nije vezan ni za Admin/Member/Instructor.');
    end;
  end
  else
    ShowMessage('Pogrešan login ili lozinka.');
end;

procedure TFrmLogin.Create_accountClick(Sender: TObject);
begin
  if frmRegister = nil then
    frmRegister := TfrmRegister.Create(Application);

  frmRegister.Show;
  Self.Hide;
end;

end.

